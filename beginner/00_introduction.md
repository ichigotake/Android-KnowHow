# Android アプリで出来る事

「Androidアプリで何が出来るの？」という声に応えるべくまとめたもの。

各種用語の詳細な説明はそこら中に溢れているので、お好みの入門書や師匠から学ぶ上でのヒントとして。


### Intent

Android アプリの各種コンポーネントを繋ぐもの。画面(Activity)やバックグラウンド処理(Service)の呼び出し、端末全体に飛ばされるイベント(BroadcastIntent)を受け取る際などで利用する共通インターフェース。

## ウィンドウ (Activity/Fragment)

いわゆる通常のアプリ画面を実装出来る。誰からも教わらなくても「」と聞けば、Activity によって実装された画面をイメージする事が多いだろう。

ウィンドウを生成したり、Service クラスを生成したり、他のアプリからイベントを受け取ったり等… Android アプリを作成する上での基本。

## 通知

端末内のアプリから通知を出す事が出来る。

通知というと「PUSH通知」をイメージする初学者も多い印象(執筆者調べ)があり、外部サーバーが無いと出せないと思っている方もいる。

「PUSH通知」のフローを紐解いてみると、実行のトリガーが外部サーバになっているだけのローカル通知と同じものである。

- [Notifications | Android Developers](http://developer.android.com/guide/topics/ui/notifiers/notifications.html)
- [RemoteViews | udinic](https://udinic.wordpress.com/tag/remoteviews/)

上記のページには実装可能なものがまとめられていて、本文は読まなくても、スクリーンショットを見ると、どんなものが実装出来るのか参考になる。

### ボタンを置く (NotificationCompat$Builder#setAction)

通知上にボタンを設置出来る。ボタンには Intent をセットする。

### 進捗を表示する ( NotificationCompat$Builder#setProgress)

「0 〜 100% の進捗を示すもの」と「終わりの読めない時間のかかる処理を示すもの」の2種類を実装出来る。

### ビューを表示する (RemoteView)

通知上に独自のビューを埋め込める。アップロードした画像のプレビューでよく利用される。

### Activity や Service を起動する (PendingIntent)

通知に Intent をセットして、タップで起動出来るようにする

よくある通常の Activity 起動 や、処理に失敗した Service クラスの再呼び出し等で利用する事が多い。

### 端末全体にイベントを飛ばす (BroadcastIntent)

例えば、アプリをインストールした際には、端末全体に Intent#ACTION_PACKAGE_ADDED イベントが飛ばされる。

BroadcastReceiver を Activity や Service に用意しておくと、アプリが端末にインストールされた瞬間に何か処理をする実装が出来る。

他のアプリとの間でルールを決めておくと、独自の Action を定義してアプリ間の連携をする事も可能。

### バックグラウンドで実行する (Service)

Activity は、ユーザの意志や OS の都合で殺されたり等され、Activity のライフサイクルは短い。画面の生存に関わらずに中断されたくない処理や、一定の時間間隔で実行したいものを Service クラスや AlarmManager 等で実装する。

逆に、画面が生きている間にだけ実行すればよい(画面が終了したらキャンセルされてもよいもの)は LoaderManager を利用する。同様に、一定の時間間隔で実行するためのものに Handler#postDelayed がある。

Service クラスで実行時間の長い処理を起動する場合は、処理の開始時に通知バーに Progress を表示し、処理が完了したら通知を消す処理をすると親切。
処理に失敗した際は、通知を出し、PendingIntent により、自分自身を再実行すると、さらによい。

## 実装例

TODO: もっとたくさん例示したい

### Twitter for Android

Twitter ヘビーユーザからは嫌われてはいるが、Android アプリのお手本要素に溢れている。

Twitter アプリが嫌われているのは、サービスの方向性やユーザのニーズとの整合性が取れていない点である(と思われる)。

以下はお手本にしたい実装の一例。

- 投稿機能のバックグラウンド実行
    - 時間のかかる画像投稿をしている最中でも、安心して別のアプリを起動出来る
    - 投稿に失敗したら通知にリトライボタンが出る
- リプライ通知
    - 通知のアクションとして「返信」や「お気に入り」があり、リプライに対して実行したい複数のアクションへの導線を示す
