# Android アプリで出来る事

「Androidアプリで何が出来るの？」という声に応えるべくまとめたもの。

各種用語の詳細な説明はそこら中に溢れているので、お好みの入門書や師匠から学ぶ上でのヒントとして。

一番伝えたいのは、自前でガッツリ実装せずとも AndroidSDK のエコシステムに乗っかれば、ガッツリ自前で実装しなくてもいい感じのアプリは作れる、という事。(ガッツリ実装する事が悪い事であるわけではないし、ガッツリ実装したい欲望は教える側から提示しなくても自然と湧いてくるだろう)


### Intent

Android アプリの各種コンポーネントを繋ぐもの。画面(Activity)やバックグラウンド処理(Service)の呼び出し、端末全体に飛ばされるイベント(BroadcastIntent)を受け取る際などで利用する共通インターフェース。

- [Intent について](https://gist.github.com/ichigotake/7ce7d91e9c29c3c38d51)
    - 「まとめ」の項目が初学の参考になるかも


----
// 上記 URL より引用

暗黙的 Intent を使うと、外部の流行に流されづらいアプリになりやすい

「共有」をするアプリを 明示的 Intent で Twitter, Facebook, はてなブックマーク等に固定するだけにしてしまうと「新しいソーシャルサービスが生まれた際に対応出来ていないアプリ」になってしまう

例えば画像を選択して実行するアプリにおいて、画像選択 UI を自前で用意せずに外部アプリの「共有」から受け取る形にすると、ユーザの好みのアプリから送ってもらえる形になる

----


## ウィンドウ (Activity/Fragment)

いわゆる通常のアプリ画面を実装出来る。誰からも教わらなくても「Androidアプリ」と聞けば、Activity によって実装された画面をイメージする事が多いだろう。

ウィンドウを生成したり、Service クラスを生成したり、他のアプリからイベントを受け取ったり等… Android アプリを作成する上での基本。

## 通知

端末内のアプリから通知を出す事が出来る。

通知というと「PUSH通知」をイメージする初学者も多い印象(執筆者調べ)があり、外部サーバーが無いと出せないと思っている方もいる。

「PUSH通知」のフローを紐解いてみると、実行のトリガーが外部サーバになっているだけのローカル通知である。

- [Notifications | Android Developers](http://developer.android.com/guide/topics/ui/notifiers/notifications.html)
- [RemoteViews | udinic](https://udinic.wordpress.com/tag/remoteviews/)

上記のページには実装可能なものがまとめられていて、本文は読まなくても、スクリーンショットを見ると、どんなものが実装出来るのか参考になる。

### ボタンを置く (NotificationCompat$Builder#setAction)

通知上にボタンを設置出来る。ボタンには Intent をセットする。

### 進捗を表示する ( NotificationCompat$Builder#setProgress)

「0 〜 100% の進捗を示すもの」と「終わりの読めない時間のかかる処理を示すもの」の2種類を実装出来る。

### ビューを表示する (RemoteView)

通知上に独自のビューを埋め込める。アップロードした画像のプレビューでよく利用される。

### Activity や Service を起動する (PendingIntent)

通知に Intent をセットして、タップで起動出来るようにする

よくある通常の Activity 起動 や、処理に失敗した Service クラスの再呼び出し等で利用する事が多い。

## 端末全体にイベントを飛ばす (BroadcastIntent)

端末全体に飛ばされるイベントは BroadcastIntent と呼ばれる。

例えば、アプリをインストールした際には、端末全体に `Intent#ACTION_PACKAGE_ADDED` イベントが飛ばされる。

`Intent#ACTION_PACKAGE_ADDED` に対応した BroadcastReceiver を用意しておくと、アプリが端末にインストールされた瞬間に何か処理をする実装が出来る。

他のアプリとの間でルールを決めておくと、独自の Action を定義してアプリ間の連携をする事も可能。

SomeActivity で何かが更新された際に OtherActivity を更新させたい場合などにも利用出来る。

## バックグラウンドで実行する (Service)

Activity は、ユーザの意志や OS の都合で殺されたり等され、Activity のライフサイクルは短い。画面の生存に関わらずに中断されたくない処理や、一定の時間間隔で実行したいものを Service クラスや AlarmManager 等で実装する。

逆に、画面が生きている間にだけ実行すればよい(画面が終了したらキャンセルされてもよいもの)は LoaderManager を利用する。同様に、一定の時間間隔で実行するためのものに Handler#postDelayed がある。

Service クラスで実行時間の長い処理を起動する場合は、処理の開始時に通知バーに Progress を表示し、処理が完了したら通知を消す処理をすると親切。
処理に失敗した際は、通知を出し、PendingIntent により自分自身を再実行すると、さらによい。

## 実装例

TODO: もっとたくさん例示したい

### Twitter for Android

Twitter ヘビーユーザからは嫌われてはいるが、Android アプリのお手本要素に溢れている。

Twitter アプリが嫌われているのは、サービスの方向性やユーザのニーズとの整合性が取れていない点である(と思われる)。

以下はお手本にしたい実装の一例。

- 投稿機能のバックグラウンド実行
    - 時間のかかる画像投稿をしている最中でも、安心して別のアプリを起動出来る
    - 投稿に失敗したら通知にリトライボタンが出る
- リプライ通知
    - 通知のアクションとして「返信」や「お気に入り」があり、リプライに対して実行したい複数のアクションへの導線を示す


### Pyazing

執筆者(@ichigotake)の作成した画像投稿アプリ。

https://github.com/ichigotake/Pyazing

便利なものを作るという目的とは別に、Activity でメイン機能を実装しなくても有用なものを作れるぞ、という例を示すためのサンプルを作る目的で製作した。

使い方と処理の流れとして以下のようなものになっている。

1. 他アプリからの「共有」で画像を受け取る
2. Pyazing の画面を生成せずに Service クラスによりバックグランドでアップロード処理を開始
    - Pyazing で Activity を生成していないので、ユーザの操作を妨げない
3. アップロードの完了を Toast と 通知 でお知らせ
4. 通知上のアクションボタンからアップロードした結果を扱える
    - クリップボードにコピー
    - WEB ブラウザの暗黙的 Intent で外部ブラウザを起動して画像のプレビュー
    - URL を「共有」で他のアプリに送る

(動画等の視覚的な情報を示していなくて申し訳ない)

特徴として以下のものが挙げられる。

- Activity の実装は最小限にする
    - 考える事はコストと考え、機能を絞る事で「何も考えなくてもサクっと使える体験」を提供する
    - 「画像をアップロードする時は早く共有したいし、タップ数と考える事を減らしたいよね」
    - 以下に擧げる特徴も、全てこの考えに基づいている
- 自前で画像選択 UI を用意せず、他のアプリからの「共有(Intentを受け取る)」で画像を受け取る
    - 自前で画像選択 UI を実装するのはとても大変(とてもとても…
    - 画像選択をユーザの好みのもので出来る
- アップロードに関する UI では ウィンドウを生成せず、ユーザの操作を止める要素を作らない
 
